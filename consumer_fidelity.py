# -*- coding: utf-8 -*-
"""consumer_fidelity.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1bAj0tiTY7wEXxQcEYzPTHSz8sG6bT5Hm
"""

def get_fidelity():

  from google.colab import auth
  import gspread
  from google.auth import default
  import numpy as np
  import math

  #autenticating to google
  auth.authenticate_user()
  creds, _ = default()
  gc = gspread.authorize(creds)
  import pandas as pd

  # Number of competing products in the results of sales
  # Number not equal to 0 
  competing_product_number = 15379

  #defining the ad-hoc worksheet 
  worksheet = gc.open('Ranking Ad-hoc questionnaire (r√©ponses)').sheet1
  #get_all_values gives a list of rows
  rows = worksheet.get_all_values()
  #Convert values to a DataFrame 
  df = pd.DataFrame(rows)
  
  # we delete the first row(titles)
  df.drop(df.head(1).index, inplace=True)
  #get the ad-hoc row that is the number of differents products used from the same product category in one year and convert it to array
  dfproductsperyear=df[15].to_numpy()

# we calculate the average of the column
  avg=0
  for i in range(0,len(dfproductsperyear)):
    avg+=int(dfproductsperyear[i])
  avg = avg/len(dfproductsperyear)
  
  fidelity_score = 1/avg 

  return fidelity_score

get_fidelity()